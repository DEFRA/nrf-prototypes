{% extends "layouts/main.html" %}

{% set pageName="New Application - Additional Details" %}

{% block content %}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

        <h1 class="govuk-heading-l">
            Additional development details
        </h1>

        <p class="govuk-body">
            Based on your development location, we need some additional information to calculate your environmental
            levy.
        </p>

        {% if applicableEDPs and applicableEDPs.length > 0 %}

        <div class="govuk-inset-text">
            <p class="govuk-body">
                <strong>Your development falls within the following Environmental Development Plans:</strong>
            </p>
            <ul class="govuk-list govuk-list--bullet">
                {% for edp in applicableEDPs %}
                <li>{{ edp.name }} ({{ edp.type }})</li>
                {% endfor %}
            </ul>
        </div>

        <form method="post" action="/applications-1/new/data">

            <!-- Basic development information -->
            <div class="govuk-form-group">
                <label class="govuk-label" for="development-name">
                    Development name
                </label>
                <input class="govuk-input" id="development-name" name="development-name" type="text"
                    value="{{ session.userData.developmentName or '' }}" required>
            </div>

            <div class="govuk-form-group">
                <label class="govuk-label" for="house-count">
                    Number of houses in the development
                </label>
                <input class="govuk-input govuk-input--width-5" id="house-count" name="house-count" type="number"
                    value="{{ session.userData.houseCount or '' }}" min="1" max="10000" required>
                <div class="govuk-hint">
                    Enter the total number of residential units in your development
                </div>
            </div>

            <!-- DLL specific requirements -->
            {% set hasDLL = false %}
            {% for edp in applicableEDPs %}
            {% if edp.type == 'DLL' %}
            {% set hasDLL = true %}
            {% endif %}
            {% endfor %}

            {% if hasDLL %}
            <h2 class="govuk-heading-l">District Level Licensing (DLL) requirements</h2>

            <p class="govuk-body">
                Your development falls within a District Level Licensing area. You need to provide pond location
                details.
            </p>

            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                        <h3 class="govuk-fieldset__heading">
                            How would you like to provide pond location details?
                        </h3>
                    </legend>
                    <div class="govuk-radios" data-module="govuk-radios">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="pond-method-draw" name="pond-method" type="radio"
                                value="draw">
                            <label class="govuk-label govuk-radios__label" for="pond-method-draw">
                                <strong>Draw on a map</strong>
                            </label>
                            <div class="govuk-hint govuk-radios__hint">
                                Use an interactive map to draw the pond boundaries
                            </div>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="pond-method-file" name="pond-method" type="radio"
                                value="file">
                            <label class="govuk-label govuk-radios__label" for="pond-method-file">
                                <strong>Upload a file</strong>
                            </label>
                            <div class="govuk-hint govuk-radios__hint">
                                Upload a shape file containing pond boundaries
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            {% endif %}

            <!-- Nutrient Mitigation specific requirements -->
            {% set hasNutrientMitigation = false %}
            {% for edp in applicableEDPs %}
            {% if edp.type == 'Nutrient Mitigation' %}
            {% set hasNutrientMitigation = true %}
            {% endif %}
            {% endfor %}

            {% if hasNutrientMitigation %}
            <h2 class="govuk-heading-l">Nutrient Mitigation requirements</h2>

            <p class="govuk-body">
                Your development falls within a Nutrient Mitigation area. You need to select a wastewater treatment
                site.
            </p>

            <div class="govuk-form-group">
                <label class="govuk-label" for="wastewater-site">
                    Select wastewater treatment site
                </label>
                <select class="govuk-select" id="wastewater-site" name="wastewater-site" required>
                    <option value="">Select a site</option>
                    {% for site in wastewaterSites %}
                    <option value="{{ site.id }}" {% if session.userData.wastewaterTreatmentSite==site.id %}selected{%
                        endif %}>
                        {{ site.name }} ({{ site.distance }} miles away)
                    </option>
                    {% endfor %}
                </select>
                <div class="govuk-hint">
                    Choose the wastewater treatment site that will handle your development's wastewater
                </div>
            </div>
            {% endif %}

            <div class="govuk-button-group">
                <button class="govuk-button" data-module="govuk-button" type="submit">
                    Continue
                </button>
                <a href="/applications-1/new/location" class="govuk-button govuk-button--secondary"
                    data-module="govuk-button">
                    Back
                </a>
            </div>

        </form>

        {% else %}

        <div class="govuk-inset-text">
            <p class="govuk-body">
                <strong>No Environmental Development Plans apply to your development site.</strong>
            </p>
            <p class="govuk-body">
                Your development location does not fall within any Environmental Development Plan boundaries.
                You may still need to provide basic development information.
            </p>
        </div>

        <form method="post" action="/applications-1/new/data">

            <div class="govuk-form-group">
                <label class="govuk-label" for="development-name">
                    Development name
                </label>
                <input class="govuk-input" id="development-name" name="development-name" type="text"
                    value="{{ session.userData.developmentName or '' }}" required>
            </div>

            <div class="govuk-form-group">
                <label class="govuk-label" for="house-count">
                    Number of houses in the development
                </label>
                <input class="govuk-input govuk-input--width-5" id="house-count" name="house-count" type="number"
                    value="{{ session.userData.houseCount or '' }}" min="1" max="10000" required>
                <div class="govuk-hint">
                    Enter the total number of residential units in your development
                </div>
            </div>

            <div class="govuk-button-group">
                <button class="govuk-button" data-module="govuk-button" type="submit">
                    Continue
                </button>
                <a href="/applications-1/new/location" class="govuk-button govuk-button--secondary"
                    data-module="govuk-button">
                    Back
                </a>
            </div>

        </form>

        {% endif %}

    </div>

    <div class="govuk-grid-column-one-third">
        <div class="govuk-card govuk-card--contained">
            <div class="govuk-card__content">
                <h2 class="govuk-heading-s">Development location</h2>
                {% if developmentLocation and developmentLocation.center %}
                <p class="govuk-body-s">
                    <strong>Coordinates:</strong><br>
                    {{ developmentLocation.center[1] | round(4) }}, {{ developmentLocation.center[0] | round(4) }}
                </p>
                {% endif %}
                <p class="govuk-body-s">
                    <strong>Boundary:</strong> Provided
                </p>
            </div>
        </div>

        {% if applicableEDPs and applicableEDPs.length > 0 %}
        <div class="govuk-card govuk-card--contained">
            <div class="govuk-card__content">
                <h2 class="govuk-heading-s">Applicable EDPs</h2>
                <ul class="govuk-list govuk-list--bullet">
                    {% for edp in applicableEDPs %}
                    <li><strong>{{ edp.type }}</strong><br>{{ edp.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        {% if wastewaterSites and wastewaterSites.length > 0 %}
        <div class="govuk-card govuk-card--contained">
            <div class="govuk-card__content">
                <h2 class="govuk-heading-s">Available treatment sites</h2>
                <p class="govuk-body-s">
                    {{ wastewaterSites.length }} sites within 50 miles
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}